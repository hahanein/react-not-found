import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import * as React from "react";
import TreeView from "./tree-view";
const Main = ({ stories, story, updateStory, }) => {
    const [search, setSearch] = React.useState("");
    const searchEl = React.useRef(null);
    const treeRoot = React.useRef(null);
    const openStorySelector = (zEvent) => {
        if ((zEvent.metaKey && zEvent.key === "p") || zEvent.key === "/") {
            if (["input", "textarea"].every((el) => zEvent.target.tagName.toLowerCase() !== el) ||
                zEvent.metaKey) {
                searchEl.current.focus();
                zEvent.preventDefault();
            }
        }
    };
    React.useEffect(() => {
        document.addEventListener("keydown", openStorySelector);
        return () => {
            document.removeEventListener("keydown", openStorySelector);
        };
    }, []);
    const canonicalSearch = search
        .toLocaleLowerCase()
        .replace(new RegExp("\\s+", "g"), "-");
    const filteredStories = stories.filter((story) => story.includes(canonicalSearch));
    return (_jsxs("nav", { role: "navigation", className: "ladle-aside", children: [_jsx("input", { placeholder: "Search", "aria-label": "Search stories", value: search, ref: searchEl, onKeyDown: (e) => {
                    if (e.key === "ArrowDown") {
                        treeRoot.current.firstChild.focus();
                    }
                }, onChange: (e) => setSearch(e.target.value) }), _jsx(TreeView, { searchRef: searchEl, stories: filteredStories, story: story, updateStory: updateStory, searchActive: search !== "", setTreeRootRef: (root) => (treeRoot.current = root) })] }));
};
export default Main;
